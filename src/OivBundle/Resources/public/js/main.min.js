(function(){function n(){$("#form-step1").toggleClass("hideLeft"),$("#form-step2").toggleClass("showRight")}function r(){$(".Form .chosen").on("chosen:ready",i).chosen({disable_search:!0}),$(".chosen.no-search").chosen({disable_search:!0}),$("#type-bdd .chosen").chosen({disable_search:!0}).on("change",function(){var e=/bdd=.*/gi,t=$(this).val();if(t!="0"){var n=window.location+"?bdd="+t;window.location.href=n.replace(e,"bdd="+$(this).val())}})}function i(e,t){s(this,e,t)}function s(e,t,n){var r=e.getAttribute("id");if(r==="country2"||r==="country3")$(e).closest(".Form-Element").hide(),$("#country").on("change",function(){var e=$("#country2");$(this).val()!==""?($(".info-comparison").show(300),e.closest(".Form-Element").show(300)):(e.closest(".Form-Element").hide(),e.val("").trigger("chosen:updated")),e.trigger("change")}),$("#country2").on("change",function(){var e=$("#country3");$(this).val()!==""?e.closest(".Form-Element").show(300):(e.closest(".Form-Element").hide(),e.val("").trigger("chosen:updated"))})}function o(){$(".Row.product_type #product_type").on("change",function(){$(this).val()!==""?$(".Row.product_type #product_type2_chosen").show(300):($(".Row.product_type #product_type2_chosen").hide(),$(".Row.product_type #product_type3_chosen").hide())}),$(".Row.product_type #product_type2").on("change",function(){$(this).val()!==""?$(".Row.product_type #product_type3_chosen").show(300):$(".Row.product_type #product_type3_chosen").hide()})}function u(e,t){var n=$(e),r=$(window),i=$(window).innerHeight(),s=r.scrollTop()+(i-i*t/100),o=n.offset().top;return o<s?!0:!1}function a(e){$(".animateContent").each(function(t,n){u(n,e)&&$(n).addClass("visible")})}function f(){$(".animateContent").each(function(e,t){$(t).addClass("visible")})}function l(e,t){var n=$(e+" "+t),r=[];return $(e+" .CitrusPager "+"li").each(function(){r.push($(this))}),r.forEach(function(){}),r}function c(){$("#result").on("click",".BddInfos_showup",function(){h(this)})}function h(e){var t=$(e).parents(".Bdd-wrapper");$(".Bdd-wrapper").not(t).removeClass("active"),t.toggleClass("active")}function p(){$("#searchStats").click(function(e){$("#error").hide(),$("#result").show(),$("#error .stats-error-valid").hide(),$("#error .error-valid").hide();var t=$("#country").val(),n=$("#yearFrom").val(),r=$("#product_conso").val();if(!t||!n||r==="")e.preventDefault(),$("#error").show(),$("#result").hide(),$("#error .error-valid").show(),$("#error .stats-error-valid").show()})}function d(){$("#searchBdd").click(function(e){$("#result .bdd-error-valid").hide(),$("#result .error-valid").hide();var t;$("#country_name").length>=0?t=$("#country_name").val():t=$("#country").val()})}function v(){$(".search-btn").on("click",function(){$(this).hasClass("active")||$(".popupSearch").addClass("show"),$(".popupSearch-input").focus()}),$(".popupSearch-close").on("click",function(e){$(".popupSearch").addClass("hide")}),$(".popupSearch").on("animationend webkitAnimationEnd MSAnimationEnd",function(e){$(this).hasClass("show")?($(this).removeClass("show"),$(this).addClass("active")):$(this).hasClass("hide")&&($(this).removeClass("hide"),$(this).removeClass("active"))})}function m(){$(".popupSearch-input").keyup(function(e){if(e.keyCode==13){var t=$(".popupSearch-input").val();searchFiltered=g(t),t.length>=3&&(window.location.href=encodeURI(rootUrl+userLang+"/search/"+searchFiltered))}}),$(".popupSearch-loupe").click(function(){var e=$(".popupSearch-input").val();searchFiltered=g(e),e.length>=3&&(window.location.href=encodeURI(rootUrl+userLang+"/search/"+searchFiltered))})}function g(e){return e=e.replace("/","--47--"),e=e.replace('"',""),e}function y(){$(".Footer-form").submit(function(e){e.preventDefault(),$(".Footer-form-msgError").hide("fast");var t=$(".Footer-form-input").val(),n=new RegExp("^[a-z0-9]+([_|.|-]{1}[a-z0-9]+)*@[a-z0-9]+([_|.|-]{1}[a-z0-9]+)*[.]{1}[a-z]{2,6}$"),r=this.action;t.length>0&&n.test(t)?$.ajax({type:"POST",url:r,data:{email:t},success:function(e){$(".Footer-form-msg").show("fast"),$(".Footer-form-input").val(""),window.setTimeout(function(){$(".Footer-form-msg").hide("fast")},3e3)}}):($(".Footer-form-msgError").show("fast"),$(".Footer-form-input").val(""))})}function b(){var e=!1;$("#show-form-step1").on("click",function(t){t.preventDefault(),e===!1&&(e=!0,n(),window.setTimeout(function(){e=!1},800))})}function w(){$(".filter-search").submit(function(e){e.preventDefault();var t=$(".filter-search-text",this).val();t=t.replace("/","--47--");var n=$(".filter-search-select option:selected",this).val();t.length>=3&&(n!==0?$(location).attr("href",rootUrl+userLang+"/search/"+t+"?r="+n):$(location).attr("href",rootUrl+userLang+"/search/"+t))})}function E(){$("#filter-order-select").on("change",function(e){var t=$(this).val(),n=document.URL,r=n.split("/"),i=r[r.length-1];r=i.split("?");var s=r[0],o;r.length>1&&(o=r[1],r=o.split("&"),r.length>1&&(o=r[0])),o&&o!==0?$(location).attr("href",rootUrl+userLang+"/search/"+s+"?"+o+"&o="+t):$(location).attr("href",rootUrl+userLang+"/search/"+s+"?o="+t)})}function S(){$("a").click(function(e){if($(this).attr("href")){var t=$(this).attr("href");if(t.substring(t.length-4)==".pdf"&&t.indexOf(host)!=-1){e.preventDefault();if(t.indexOf(host)!=-1){var n="http://"+t.split("/")[2];t=t.replace(n,"")}var r="/js/lib/pdfjs/web/viewer.html?file="+t;window.open(r,"_blank")}}})}function x(e){var t=null,n=null,r="http://api.bitly.com/v3/shorten?format=json&apiKey=R_b55636564bb844c98762f4f700f6473e&login=studiocaramia&longUrl="+e;return $.ajax({url:r,type:"get",dataType:"html",async:!1,success:function(e){n=JSON.parse(e),t=n.data.url}}),t}function T(){$(".Chapo-tool .tw").click(function(e){e.preventDefault();var t=$(this).attr("data-title"),n=$(this).attr("href"),r=x(n),i="http://www.twitter.com/share?text="+t+" &url="+r+"&hashtags=OIV";window.open(i,"","toolbar=no, scrollbars=no, resizable=yes, top=200, left=600, width=475, height=250")})}function N(){$(".Chapo-share").on("click",".Chapo-share-lnk.fb",function(e){e.preventDefault();var t=($(window).width()-495)/2,n=($(window).height()-360)/2,r=this.href,i="status=1,width=540,height=360,top="+n+",left="+t;window.open(r,"share",i)})}function C(){$(".filter-agenda-select").on("change",function(e){var t=$("#agenda-pays").val(),n=$("#agenda-theme").val(),r=$("#agenda-mois").val(),i=$("#agenda-annee").val(),s=!1;$(".Agenda-item-titre").hasClass("past")&&(s=!0),$.ajax({type:"GET",url:"/filterAgenda",data:{theme:n,pays:t,mois:r,annee:i,past:s,page:1},success:function(e){$("#agenda-content").html(e),s===!0?($("#past-agenda").html("Évènements à venir"),$(".filter-agenda-title").addClass("past"),$(".filter-agenda-btn").addClass("past")):($("#past-agenda").html("Évènements passés"),$(".filter-agenda-title").removeClass("past"),$(".filter-agenda-btn").removeClass("past"))}})})}function k(){$("#agenda-content").on("click",".FrontPagination a",function(e){e.preventDefault();if($(this).attr("href")==="#")return;var t=$("#agenda-pays").val(),n=$("#agenda-theme").val(),r=$("#agenda-mois").val(),i=$("#agenda-annee").val(),s=!1;$(".Agenda-item-titre").hasClass("past")&&(s=!0);var o=$(this).hasClass("Button")?parseInt($("#agenda-content .FrontPagination li.active a").html())+1:$(this).html();$.get("/filterAgenda",{theme:n,pays:t,mois:r,annee:i,past:s,page:o},function(e){$("#agenda-content").html(e),$(window).scrollTop($("#filter-agenda").offset().top)})})}function L(){$("#past-agenda").click(function(e){e.preventDefault();var t=$("#agenda-pays").val(),n=$("#agenda-theme").val(),r=$("#agenda-mois").val(),i=$("#agenda-annee").val(),s=!0;$(".Agenda-item-titre").hasClass("past")&&(s=!1),$.ajax({type:"GET",url:"/filterAgenda",data:{theme:n,pays:t,mois:r,annee:i,past:s,page:1},success:function(e){$("#agenda-content").html(e),s===!0?($("#past-agenda").html("Évènements à venir"),$(".filter-agenda-title").addClass("past"),$(".filter-agenda-btn").addClass("past")):($("#past-agenda").html("Évènements passés"),$(".filter-agenda-title").removeClass("past"),$(".filter-agenda-btn").removeClass("past"))}})})}function A(){if($("#publication-list")===0)return;$(".Fiche-medias").each(function(e,t){var n=$(this).find("a.Button"),r=$(this).find("option:eq(0)").attr("value");n.attr("href",r),$(this).find(".chosen").on("change",function(e){var t=$(this).val();n.attr("href",t)})});var e=$(".chapo-side").find(".Button"),t=$(".chapo-side").find("select").find("option:eq(0)").attr("value");e.attr("href",t),$(".chapo-side").find("select").on("change",function(t){var n=$(this).val();e.attr("href",n)}),window.location.hash.length>0&&$("#publication-list").length>0&&$('.Fiche-anchor[name="'+window.location.hash.replace("#","")+'"]',"#publication-list").closest(".Fiche").addClass("anchored")}function O(){var e=location.href,t=location.search.split("bdd=")[1];if(t&&t.length>0){var n=$("#type-bdd").offset(),r=n.top;window.scrollTo(0,r-150)}}function M(e){$(".nav-toggle").on("click",function(e){e.preventDefault(),$("body").toggleClass("showMenu"),isTablet!="1"&&($("body").hasClass("showMenu")?($(".top-bar-fade").fadeIn("fast"),$(".accueil > img").hide()):($(".top-bar-fade").fadeOut("fast"),$(".accueil > img").show()))})}function _(){function i(i){i>=t+100?(n.addClass("shown"),e.addClass("sticky"),r.addClass("no-nav")):(e.removeClass("sticky hidden"),n.removeClass("shown"),r.removeClass("no-nav"))}var e=$("nav:not(.mobile)"),t=540,n=$(".sticky-menu-toggle"),r=$("header");i($(window).scrollTop()),$(window).on("scroll",function(e){i(window.pageYOffset)}),$(".sticky-menu-toggle").on("click",function(t){e.hasClass("shown")?(e.toggleClass("hidden"),e.removeClass("shown")):(e.toggleClass("shown"),e.removeClass("hidden")),$(".ico-burger").toggleClass("close")})}function D(){$(".bloc-links-container").on("click",function(e){var t=$(".block-links-item-link",$(this)).attr("href");$(location).attr("href",t)})}function P(){function e(){var e=$("#tabletViewport");window.matchMedia("(orientation: portrait)").matches&&e&&e.attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),window.matchMedia("(orientation: landscape)").matches&&e&&e.attr("content","width=device-width, initial-scale=0.7, maximum-scale=0.7, user-scalable=no")}$(window).on("orientationchange",e),e()}function H(e,t){var n=new Date;n.setTime(n.getTime()+31536e6),document.cookie=e+"="+t+";expires="+n.toUTCString()}function B(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null}function j(){var e=B("eucookie");e||$("#popup-cookie").addClass("shown"),$("#popup-cookie .Button").on("click",function(){$("#popup-cookie").removeClass("shown"),H("eucookie","1")})}function F(){$("select.chosen").each(function(e,t){$(t).css("opacity",0).wrap('<div class="mchosen-wrapper"></div>');var n=$(t).data("mc-width");n?($(t).parent().css("width",n+"px"),$(t).css("width",n+"px")):(n="100%",$(t).parent().css("width",n));var r=$(t).children("option").filter(":selected").text(),i=$(t).attr("id");$(t).after('<label for="'+i+'">'+r+"</label>"),$(t).parent().append("<i></i>"),$(t).on("change",function(e){$(this).next().html($(this).children("option").filter(":selected").text())})})}function I(){var e={},t=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,r){e[n]=r});return e}function q(){var e=I();e.bdd&&$("#formBdd").removeClass("hidden")}function R(){if("ontouchstart"in document.documentElement)for(var e=document.styleSheets.length-1;e>=0;e--){var t=document.styleSheets[e];if(t.cssRules)for(var n=t.cssRules.length-1;n>=0;n--){var r=t.cssRules[n];r.selectorText&&(r.selectorText=r.selectorText.replace(":hover",":active"))}}}var e=function(){this.url=!1,this.trigger=!1,this.type=!1,this.param=!1,this.ajx_name="-ajx",this.container=!1,this.init()};e.prototype={init:function(){var e=this;$("body").on("submit",'form[action$="'+this.ajx_name+'"], form.Ctrl'+this.ajx_name,function(t){t.preventDefault(),e.type="form",e.elt=$(this),e.handle($(this))}),$("body").on("click",'a[href$="'+this.ajx_name+'"], a.Ctrl'+this.ajx_name,function(t){t.preventDefault(),e.type="link",e.elt=$(this),e.handle($(this))}),$("body").on("click","#pagerBdd li a",function(t){t.preventDefault(),e.param="page="+this.innerHTML,e.type="form",e.elt=$("#formBdd","body"),e.handle(e.elt),$(window).scrollTop($("#formBdd").offset().top)}),$("body").on("click","#pagerBdd-next",function(e){e.preventDefault();var t=$("#pagerBdd li.active").next().children("a");$(t).trigger("click"),$(window).scrollTop($("#formBdd").offset().top)}),$("body").on("click",".bdd-stat",function(t){t.preventDefault(),e.elt=$(this),e.type="link",e.param="lst="+$("#result_ids").val();var n=$("#result_ids2");n.length&&(e.param+="&lst2="+$("#result_ids2").val());var r=$("#result_ids3");r.length&&(e.param+="&lst3="+$("#result_ids3").val());var i=$("#product_conso").val();i!==""&&(e.param+="&type="+i),e.handle(e.elt)})},handle:function(e){if(this.trigger===!1){this.url=this.type=="form"?e.attr("action"):e.attr("href"),is_correct=!0,this.trigger=!0;if(this.elt.hasClass("validate")){var n=new t(this.elt);is_correct=n.validation()}is_correct?this.send():this.trigger=!1}},send:function(){var e=this;e.setParam(),$.post(this.url,e.param).done(function(r){var i;r.retour&&(i=e.elt.attr("data-container"),typeof i=="undefined"&&(i=e.container),i&&$(i).empty().append(r.retour),e.activeJs());if(r.message){var s={html:r.message,close:"&nbsp;",onComplete:function(){e.activeJs(),$.colorbox.resize()}};$.colorbox(s)}r.url&&window.location.replace(r.url),r.graph&&(i=e.elt.attr("data-container"),e.showGraph(r,i));if(r.contact)if(r.retour===!0)n(),e.elt[0].reset();else{var o=new t(this.elt);o.showAjxError(".simple-error")}e.trigger=!1,e.param=!1}).fail(function(t){e.trigger=!1,e.param=!1})},setParam:function(){if(this.type=="form"){var e=this.elt.serialize();this.param=this.param!==!1?this.param+"&"+e:e}},activeJs:function(e){var t=$("#result .Bdd-wrapper .bdd-stat").first();t&&window.setTimeout(function(){t.trigger("click")},0)},showGraph:function(e,t){showGraph=!1;var n=e.graph.years.length,r=!1;this.elt.closest(".Bdd-wrapper.active").length===0&&(showGraph=!0),h(this.elt);if(showGraph){self.barChart&&self.barChart.destroy();var i=[{label:"",fillColor:"rgba(51,56,73,1)",strokeColor:"rgba(51,56,73,1)",highlightFill:"rgba(51,56,73,0.65)",highlightStroke:"rgba(51,56,73,0,8)",data:e.graph.values}];typeof e.graph.values2!="undefined"&&(i.push({label:"",fillColor:"rgba(124,125,125,1)",strokeColor:"rgba(124,125,125,1)",highlightFill:"rgba(124,125,125,0.65)",highlightStroke:"rgba(124,125,125,0.8)",highlightStroke:"rgba(124,125,125,0.8)",data:e.graph.values2}),r=!0),typeof e.graph.values3!="undefined"&&i.push({label:"",fillColor:"rgba(176,33,67,1)",strokeColor:"rgba(176,33,67,1)",highlightFill:"rgba(176,33,67,0.65)",highlightStroke:"rgba(176,33,67,0,8)",data:e.graph.values3}),e={labels:e.graph.years,datasets:i};var s=document.getElementById(t).getContext("2d"),o={};if(!r&&n==1)var o={isFixedWidth:!0,barWidth:40,barValueSpacing:206,scaleLabel:"<%=' ' + value%>",tooltipTitleFontSize:0};else var o={scaleLabel:"<%=' ' + value%>",tooltipTitleFontSize:0};var u=(new Chart(s)).Bar(e,o);self.barChart=u}}};var t=function(e){this.elt=e,this.errors=[],this.error_empty=!1,this.error_phone_empty=!1};t.prototype={constructor:t,init:function(e){this.elt=e,this.errors=[]},validation:function(){this.reset();var e,t,n=$(this.elt),r=this,i=n.find("input, textarea").not('[type="hidden"]').not(".no-control");for(e=0,t=i.length;e<t;e++)this.valide(i[e]);return this.showErrors(),this.errors.length===0},valide:function(e,t){var n=$(e);n.hasClass("not")||(n.hasClass("email")&&!this.isEmail(n.val())?(this.errors.push([n,".email-error"]),$(".email-error").show()):n.val()===""&&(this.error_empty?this.errors.push([n]):(this.errors.push([n,".simple-error"]),$(".simple-error").show()),this.error_empty=!0))},confirmation_password:function(){var e=$(".password",this.elt).not(".no-control").eq(0),t=$(".password",this.elt).eq(1);e.length&&(e.val()!==""&&!this.isValidPassword(e.val())?(this.errors.push([e,"Le  mot de passe doit contenir entre 6 et 20 caractères, lettres ET chiffres !"]),this.errors.push([t])):t.length&&e.val()!==t.val()&&(this.errors.push([e,"Les deux mots de passe sont différents."]),this.errors.push([t])))},confirmation_email:function(){var e=$(".email",this.elt).eq(0),t=$(".email",this.elt).eq(1);e.length&&(e.val!==""&&!this.isEmail(e.val())?(this.errors.push([e,"L'email n’est pas valide."]),this.errors.push([t])):t.length&&e.val()!==t.val()&&(this.errors.push([e,"Les deux emails sont différents."]),this.errors.push([t])))},confirmation_date:function(){var e=$("#birth_date_j"),t=$("#birth_date_m"),n=$("#birth_date_a");e.length&&(date=e.val()+"/"+t.val()+"/"+n.val(),this.isDate(date)||(this.errors.push([e,"Le format de la date n'est pas correct."]),this.errors.push([t]),this.errors.push([n])))},isEmail:function(e){var t=new RegExp(/^[a-zA-Z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,10}$/);return t.test(e)},isValidPassword:function(e){var t=new RegExp(/^(?=.*\d).{6,20}$/);return t.test(e)},isDate:function(e){var t=new RegExp(/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/);return t.test(e)},isPhone:function(e){var t=new RegExp(/^[0-9]{10}$/);return t.test(e)},isPostalCode:function(e){var t=new RegExp(/^[0-9]{2}[\s]?[0-9]{3}$/);return t.test(e)},showErrors:function(){var e="",t=0;len=this.errors.length;if(this.errors.length>0){for(;t<len;t++){this.errors[t][0].addClass("Form-error");var n=this.errors[t][1];n&&$(n,this.elt).show()}var r=$("#infos-error");r.length>0&&r.show()}},showAjxError:function(e){var t=$("#infos-error");t.length>0&&(t.show(),$(e,this.elt).show())},reset:function(){this.errors=[],$(".Form-error").removeClass("Form-error");var e=$("#infos-error").hide().find(".email-error, .simple-error").hide()},cancelForm:function(){this.reset(),this.elt.reset()}},$(document).ready(function(){var t=new e;c(),r(),isMobile!=1?(a(0),$(document).on("scroll",function(e){a(0)})):f(),v(),m(),w(),E(),y(),d(),p(),b(),S(),T(),N(),A(),C(),L(),O(),D(),M(isTablet),k(),isMobile==1&&R(),isMobile==1&&isTablet!=1&&F(),isMobile!=1&&(window.hasOwnProperty("matchMedia")?window.matchMedia("(min-width:769px)").matches&&_():_()),isTablet==1&&P(),j(),q(),$(".select-lang").on("change",function(){window.location.href=$(this).val()}),$('[contenteditable="true"]').attr("contenteditable","false"),$(".contact-map-container").detach().appendTo(".page-contact .Content_aplat .Page_center"),setTimeout(function(){$(".HomeArticle-media").fadeIn("fast")},800)})})()